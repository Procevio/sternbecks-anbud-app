# üìã KOMPLETT VARIABELLISTA F√ñR ZAPIER AUTOMATION

**Skapad f√∂r:** Sternbecks Anbudsapp  
**Datum:** 2025-08-21  
**Syfte:** Mappning f√∂r Zapier automation och Google Forms integration  

## üóÇÔ∏è INNEH√ÖLLSF√ñRTECKNING

1. [Formul√§rf√§lt (Input-variabler)](#1-formul√§rf√§lt-input-variabler)
2. [Google Forms Mappning](#2-google-forms-mappning)
3. [JavaScript Ber√§knings-variabler](#3-javascript-ber√§knings-variabler)
4. [DOM Element-IDs och CSS-klasser](#4-dom-element-ids-och-css-klasser)
5. [Zapier Webhook Payload](#5-zapier-webhook-payload)
6. [Specialv√§rden och Validering](#6-specialv√§rden-och-validering)

---

## 1. FORMUL√ÑRF√ÑLT (INPUT-VARIABLER)

### üìû KONTAKTINFORMATION

| F√§ltnamn | HTML ID | HTML name | Typ | Beskrivning | Obligatoriskt |
|----------|---------|-----------|-----|-------------|---------------|
| **F√∂retag/Namn** | `company` | `company` | text | Kundnamn eller f√∂retagsnamn | ‚úÖ Ja |
| **Kontaktperson** | `contact_person` | `contact_person` | text | Namn p√• kontaktperson | ‚ùå Nej |
| **E-post** | `email` | `email` | email | E-postadress | ‚úÖ Ja |
| **Telefonnummer** | `phone` | `phone` | tel | Telefonnummer | ‚úÖ Ja |
| **Adress** | `address` | `address` | text | Gatuadress | ‚úÖ Ja |
| **Fastighetsbeteckning** | `fastighetsbeteckning` | `fastighetsbeteckning` | text | T.ex. "Exempel 1:23" (auto-fyller "-" om tomt) | ‚ùå Nej |
| **Postnummer** | `postal_code` | `postal_code` | text | 5 siffror, pattern: [0-9]{5} | ‚úÖ Ja |
| **Ort** | `city` | `city` | text | Ortnamn | ‚úÖ Ja |

### üîß TYP AV RENOVERING

| F√§ltnamn | HTML ID | HTML name | Typ | V√§rden | Obligatoriskt |
|----------|---------|-----------|-----|--------|---------------|
| **Renoveringstyp** | `typ_av_renovering` | `typ_av_renovering` | select | "Traditionell - Linoljebehandling", "Modern - Alcro best√•" | ‚úÖ Ja |

### üë∑ ARBETSBESKRIVNING

| F√§ltnamn | HTML name | Typ | M√∂jliga v√§rden | Obligatoriskt |
|----------|-----------|-----|----------------|---------------|
| **Arbetsbeskrivning** | `arbetsbeskrivning` | radio | "Utv√§ndig renovering", "Inv√§ndig renovering", "Utv√§ndig renovering samt m√•lning av innerb√•gens insida" | ‚úÖ Ja |

### ü™ü TYP AV F√ñNSTER (CHECKBOXES - KAN V√ÑLJA FLERA)

| F√§ltnamn | HTML name | Typ | M√∂jliga v√§rden | Prisp√•verkan |
|----------|-----------|-----|----------------|--------------|
| **F√∂nstertyper** | `typ_av_fonster[]` | checkbox[] | Se lista nedan | Varierande |

**Tillg√§ngliga f√∂nstertyp-alternativ:**
- `"Kopplade standard"` ‚Üí Standard pris (1.0x)
- `"Isolerglas"` ‚Üí +400kr per f√∂nster
- `"Kopplade isolerglas"` ‚Üí **+20% p√• totalsumman** ‚≠ê NY
- `"Insatsb√•gar yttre"` ‚Üí Inget pris i nul√§get (0kr) ‚≠ê NY
- `"Insatsb√•gar inre"` ‚Üí Inget pris i nul√§get (0kr) ‚≠ê NY  
- `"Insatsb√•gar komplett"` ‚Üí Inget pris i nul√§get (0kr) ‚≠ê NY
- `"In√•tg√•ende"` ‚Üí -5% (0.95x)
- `"Ut√•tg√•ende"` ‚Üí Standard pris (1.0x)

### üí∞ PRISJUSTERING

| F√§ltnamn | HTML ID | HTML name | Typ | Beskrivning | Standardv√§rde |
|----------|---------|-----------|-----|-------------|---------------|
| **Till√§gg (+)** | `price_adjustment_plus` | `price_adjustment_plus` | number | Till√§gg i kronor | 0 |
| **Avdrag (-)** | `price_adjustment_minus` | `price_adjustment_minus` | number | Avdrag i kronor | 0 |
| **Materialkostnad** | `materialkostnad` | `materialkostnad` | select | Procent: 5, 7, 10, 13, 15, 20 | 10% |

### üî¢ ANTAL PARTIER

| F√§ltnamn | HTML ID | HTML name | Typ | Beskrivning | Placeholder |
|----------|---------|-----------|-----|-------------|-------------|
| **F√∂nsterpartier** | `window_sections` | `window_sections` | number | Totalt antal f√∂nsterpartier | "Ange antal" |
| **D√∂rrpartier** | `antal_dorrpartier` | `antal_dorrpartier` | number | Antal d√∂rrpartier (6000kr/st) | "Ange antal" |
| **1 luftare** | `antal_1_luftare` | `antal_1_luftare` | number | Antal 1-luftare (3500kr/st) | "Ange antal" |
| **2 luftare** | `antal_2_luftare` | `antal_2_luftare` | number | Antal 2-luftare (5000kr/st) | "Ange antal" |
| **3 luftare** | `antal_3_luftare` | `antal_3_luftare` | number | Antal 3-luftare (6500kr/st) | "Ange antal" |
| **4 luftare** | `antal_4_luftare` | `antal_4_luftare` | number | Antal 4-luftare (8000kr/st) | "Ange antal" |
| **5 luftare** | `antal_5_luftare` | `antal_5_luftare` | number | Antal 5-luftare (9000kr/st) | "Ange antal" |
| **6 luftare** | `antal_6_luftare` | `antal_6_luftare` | number | Antal 6-luftare (11000kr/st) | "Ange antal" |

### üñºÔ∏è SPR√ñJS

| F√§ltnamn | HTML name | Typ | V√§rden | Beskrivning |
|----------|-----------|-----|--------|-------------|
| **Spr√∂js val** | `sprojs_choice` | radio | "Nej" (default), "Ja" | Aktiverar spr√∂js-f√§lt |
| **Antal spr√∂js per b√•ge** | `antal_sprojs_per_bage` | number | Heltal | Visas endast om "Ja" valts (300kr/ruta) |

### ‚ú® LE-GLAS

| F√§ltnamn | HTML ID | HTML name | Typ | V√§rden | Beskrivning |
|----------|---------|-----------|-----|--------|-------------|
| **LE-glas val** | - | `le_glas_choice` | radio | "Nej" (default), "Ja" | Aktiverar LE-glas f√§lt |
| **LE-glas kvm** | `le_kvm` | `le_kvm` | number | Decimal | Visas endast om "Ja" valts (2500kr/kvm) |

### üè† ROT-AVDRAG

| F√§ltnamn | HTML name | Typ | M√∂jliga v√§rden | Obligatoriskt |
|----------|-----------|-----|----------------|---------------|
| **Fastighet ROT-ber√§ttigad** | `fastighet_rot_ber√§ttigad` | radio | "Ja - Villa/Radhus", "Nej - Hyresr√§tt/Kommersiell fastighet" | ‚úÖ Ja |
| **Kund ROT-ber√§ttigad** | `√§r_du_ber√§ttigad_rot_avdrag` | radio | "Ja - inkludera ROT-avdrag i anbudet", "Nej - visa fullpris utan avdrag" | ‚úÖ Ja |

---

## 2. GOOGLE FORMS MAPPNING

### üì° CONFIG.FORM_FIELDS (assets/js/app.js)

```javascript
FORM_FIELDS: {
    'company': 'entry.840064910',
    'contact_person': 'entry.840064910',    // ‚ö†Ô∏è Anv√§nder samma som company
    'email': 'entry.34850442',
    'phone': 'entry.1576794399',
    'address': 'entry.451691303',
    'postal_code': 'entry.183003918',
    'city': 'entry.1773944220',
    'fastighetsbeteckning': 'entry.1947831774',
    'typ_av_renovering': 'entry.1001679891',
    'arbetsbeskrivning': 'entry.987654321',
    'typ_av_fonster': 'entry.1431165045',      // ‚≠ê CHECKBOX ARRAY ‚Üí joinad str√§ng
    'extra_hours': 'entry.280137558',          // ‚ùå Anv√§nds inte i nuvarande form
    'materialkostnad': 'entry.1087712385',
    'window_sections': 'entry.1428207307',
    'antal_dorrpartier': 'entry.15247411',
    'antal_1_luftare': 'entry.1346898155',
    'antal_2_luftare': 'entry.994599656',
    'antal_3_luftare': 'entry.882686399',
    'antal_4_luftare': 'entry.421567894',
    'antal_5_luftare': 'entry.15154510',
    'antal_6_luftare': 'entry.904743569',
    'sprojs': 'entry.105600632',               // ‚ùå Borde vara sprojs_choice
    'antal_sprojs_per_bage': 'entry.1553251704',
    'byte_till_le_glas': 'entry.1641252616',  // ‚ùå Borde vara le_glas_choice  
    'le_kvm': 'entry.1217325448',
    'fastighet_rot_ber√§ttigad': 'entry.1617253565',
    '√§r_du_ber√§ttigad_rot_avdrag': 'entry.234567890' // ‚ö†Ô∏è PLACEHOLDER - UPPDATERA!
}
```

### üìã EXTRA GOOGLE FORMS F√ÑLT

Dessa f√§lt skickas ocks√• automatiskt:

| F√§ltnamn | Entry ID | V√§rde | Beskrivning |
|----------|----------|-------|-------------|
| **ROT Ber√§knat belopp** | `entry.ROT_CALCULATED_AMOUNT` | Formaterad str√§ng | Endast om ROT-avdrag aktivt |
| **Prisber√§kning** | `entry.calculated_price` | Detaljerad text | Komplett prissammanfattning |

---

## 3. JAVASCRIPT BER√ÑKNINGS-VARIABLER

### üíª PRISS√ÑTTNING (CONFIG objekt)

```javascript
// Grundpriser per enhet (kronor)
UNIT_PRICES: {
    'antal_dorrpartier': 6000,
    'antal_1_luftare': 3500,
    'antal_2_luftare': 5000,
    'antal_3_luftare': 6500,
    'antal_4_luftare': 8000,
    'antal_5_luftare': 9000,
    'antal_6_luftare': 11000
}

// Renoveringstyp multiplikatorer
RENOVATION_TYPE_MULTIPLIERS: {
    'Traditionell - Linoljebehandling': 1.15,  // +15%
    'Modern - Alcro best√•': 1.0                // Standard
}

// F√∂nstertyp multiplikatorer ‚≠ê UPPDATERAT
WINDOW_TYPE_MULTIPLIERS: {
    'Kopplade standard': 1.0,
    'Isolerglas': 'per_window_400',        // +400kr per f√∂nster
    'Kopplade isolerglas': 1.20,          // +20% p√• totalen ‚≠ê NY
    'Insatsb√•gar yttre': 0,               // Inget pris ‚≠ê NY
    'Insatsb√•gar inre': 0,                // Inget pris ‚≠ê NY
    'Insatsb√•gar komplett': 0,            // Inget pris ‚≠ê NY
    'In√•tg√•ende': 0.95,                   // -5%
    'Ut√•tg√•ende': 1.0
}

// Arbetsbeskrivning multiplikatorer
WORK_DESCRIPTION_MULTIPLIERS: {
    'Utv√§ndig renovering': 1.0,
    'Inv√§ndig renovering': 1.25,          // +25%
    'Utv√§ndig renovering samt m√•lning av innerb√•gens insida': 1.05  // +5%
}

// Till√§gg
EXTRAS: {
    SPROJS_PER_RUTA: 300,     // 300kr per ruta
    E_GLASS_PER_SQM: 2500,    // 2500kr/kvm
    VAT_RATE: 0.25,           // 25% moms
    ROT_DEDUCTION: 0.5        // 50% ROT-avdrag
}
```

### üßÆ BER√ÑKNINGS-VARIABLER (collectPricingData)

Dessa variabler skapas i JavaScript f√∂r intern ber√§kning:

| Variabel | Typ | K√§lla | Beskrivning |
|----------|-----|-------|-------------|
| `doorSections` | number | `antal_dorrpartier` | Antal d√∂rrpartier |
| `luftare1-6` | number | `antal_X_luftare` | Antal luftare per typ |
| `totalWindows` | number | `window_sections` | Totalt antal f√∂nster |
| `renovationType` | string | `typ_av_renovering` | Vald renoveringstyp |
| `workDescription` | string | `arbetsbeskrivning` | Vald arbetsbeskrivning |
| `windowTypes` | Array | `typ_av_fonster[]` | ‚≠ê Array av valda f√∂nstertyper |
| `priceAdjustmentPlus/Minus` | number | Prisjustering | Till√§gg/avdrag |
| `materialPercentage` | number | `materialkostnad` | Materialkostnad i % |
| `hasSprojs` | boolean | `sprojs_choice` | Om spr√∂js √§r valt |
| `sprojsPerWindow` | number | `antal_sprojs_per_bage` | Antal spr√∂js per b√•ge |
| `hasEGlass` | boolean | `le_glas_choice` | Om LE-glas √§r valt |
| `eGlassSqm` | number | `le_kvm` | LE-glas kvm |
| `hasRotDeduction` | boolean | ROT-fr√•gor | Om ROT-avdrag ska till√§mpas |

### üìä BER√ÑKNINGS-RESULTAT

Dessa v√§rden ber√§knas och visas i prisavsnittet:

| Variabel | Beskrivning | Visas i |
|----------|-------------|---------|
| `baseComponentsPrice` | Grundpris (luftare + d√∂rrar) | `#base-components-price` |
| `renovationTypeCost` | Renoveringstyp-till√§gg | Kombineras i `#window-type-cost` |
| `windowTypeCost` | F√∂nstertyp-till√§gg | `#window-type-cost` |
| `extrasCost` | Spr√∂js + LE-glas | `#extras-cost` |
| `workDescriptionMarkup` | Arbetsbeskrivning-p√•slag | `#renovation-markup` |
| `priceAdjustment` | Prisjustering | `#extra-hours-cost` |
| `materialCost` | Materialkostnad | `#material-cost-display` |
| `subtotalExclVat` | Summa exkl. moms | `#subtotal-price` |
| `vatCost` | Moms (25%) | `#vat-cost` |
| `totalInclVat` | ‚≠ê Total inkl. moms | `#total-with-vat` |
| `materialDeduction` | ‚≠ê Materialkostnad (fr√•n total inkl. moms) | `#material-deduction` |
| `rotDeduction` | ‚≠ê ROT-avdrag (efter material) | `#rot-deduction` |
| `finalCustomerPrice` | ‚≠ê Slutpris kunden betalar | `#final-customer-price` |

---

## 4. DOM ELEMENT-IDS OCH CSS-KLASSER

### üéØ VIKTIGA ELEMENT-IDS

#### Formul√§relement
| ID | Typ | Beskrivning |
|----|-----|-------------|
| `quote-form` | form | Huvudformul√§ret |
| `submit-btn` | button | Skicka-knappen |
| `loading-spinner` | div | Laddnings-animation |

#### Prisvisning  
| ID | Typ | Inneh√•ll |
|----|-----|----------|
| `base-components-price` | span | Grundkomponenter pris |
| `window-type-cost` | span | F√∂nster- och renoveringstyp kostnad |
| `extras-cost` | span | Spr√∂js/LE-glas kostnad |
| `renovation-markup` | span | Arbetsbeskrivning p√•slag |
| `extra-hours-cost` | span | Prisjustering |
| `material-cost-display` | span | Materialkostnad |
| `subtotal-price` | span | Summa exkl. moms |
| `vat-cost` | span | Moms |
| `total-with-vat` | span | ‚≠ê Total inkl. moms |
| `material-deduction` | span | ‚≠ê Materialkostnad avdrag |
| `rot-row` | div | ROT-avdrag rad (visa/d√∂lj) |
| `rot-deduction` | span | ROT-avdrag belopp |
| `final-customer-price` | span | ‚≠ê Slutpris |

#### Validering
| ID | Typ | Beskrivning |
|----|-----|-------------|
| `parties-validation` | div | Validering f√∂r antal partier |
| `parties-validation-text` | span | Valideringstext |
| `success-message` | div | Framg√•ngsmeddelande |
| `error-message` | div | Felmeddelande |

#### L√∂senordsskydd
| ID | Typ | Beskrivning |
|----|-----|-------------|
| `password-overlay` | div | L√∂senordssk√§rm |
| `password-form` | form | L√∂senordsformul√§r |
| `password-input` | input | L√∂senordsf√§lt |
| `password-error` | div | L√∂senordsfel |
| `main-app` | main | Huvudapplikation |

#### Tema och Navigation
| ID | Typ | Beskrivning |
|----|-----|-------------|
| `theme-toggle` | button | Tema-v√§xlare |

### üé® VIKTIGA CSS-KLASSER

#### Formul√§r-styling
| Klass | Beskrivning |
|-------|-------------|
| `.container` | Huvudcontainer |
| `.form-container` | Formul√§rcontainer |
| `.form-header` | Formul√§rhuvud |
| `.quote-form` | Formul√§rstyling |
| `.form-section` | Formul√§rsektioner |
| `.form-row` | Formul√§rrader |
| `.form-group` | Formul√§rgrupper |
| `.form-select` | Select-element styling |

#### Input-element
| Klass | Beskrivning |
|-------|-------------|
| `.radio-group` | Radio button grupp |
| `.radio-label` | Radio button label |
| `.radio-custom` | Anpassad radio styling |
| `.checkbox-group` | ‚≠ê Checkbox grupp |
| `.checkbox-label` | ‚≠ê Checkbox label |
| `.checkmark` | ‚≠ê Anpassad checkbox styling |

#### Layout
| Klass | Beskrivning |
|-------|-------------|
| `.half-width` | 50% bredd (tablet+) |
| `.third-width` | 33% bredd (tablet+) |
| `.quarter-width` | 25% bredd (tablet+) |

#### Prisvisning
| Klass | Beskrivning |
|-------|-------------|
| `.price-section` | Prissektion |
| `.price-breakdown` | Prisuppdelning |
| `.price-category` | Priskategori |
| `.price-row` | Prisrad |
| `.price-separator` | Prisseparator |
| `.final-separator` | Final prisseparator |

#### Meddelanden och Validering
| Klass | Beskrivning |
|-------|-------------|
| `.error-message` | Felmeddelanden |
| `.validation-message` | Valideringsmeddelanden |
| `.message` | Allm√§nna meddelanden |
| `.success-message` | Framg√•ngsmeddelanden |

#### Knappar
| Klass | Beskrivning |
|-------|-------------|
| `.submit-btn` | Skicka-knapp |
| `.submit-btn.loading` | Knapp i laddningsl√§ge |
| `.btn-text` | Knapptext |
| `.loading-spinner` | Laddnings-spinner |

---

## 5. ZAPIER WEBHOOK PAYLOAD

### üì° F√ñRV√ÑNTAD PAYLOAD-STRUKTUR

N√§r formul√§ret skickas, skickas f√∂ljande data till Google Forms (och d√§rmed tillg√§ngligt f√∂r Zapier):

```json
{
  // Kontaktinformation
  "entry.840064910": "F√∂retagsnamn AB", 
  "entry.34850442": "kontakt@f√∂retag.se",
  "entry.1576794399": "08-123 456 78",
  "entry.451691303": "Testgatan 123",
  "entry.183003918": "12345",
  "entry.1773944220": "Stockholm",
  "entry.1947831774": "Exempel 1:23",
  
  // Projektinfo
  "entry.1001679891": "Modern - Alcro best√•",
  "entry.987654321": "Utv√§ndig renovering",
  "entry.1431165045": "Kopplade standard, Isolerglas", // ‚≠ê JOINAD STR√ÑNG
  "entry.1087712385": "10",
  
  // Antal
  "entry.1428207307": "5",
  "entry.15247411": "1", 
  "entry.1346898155": "3",
  "entry.994599656": "2",
  "entry.882686399": "0",
  "entry.421567894": "0", 
  "entry.15154510": "0",
  "entry.904743569": "0",
  
  // Till√§gg  
  "entry.1553251704": "0",
  "entry.1217325448": "0.0",
  
  // ROT-avdrag
  "entry.1617253565": "Ja - Villa/Radhus",
  "entry.234567890": "Nej - visa fullpris utan avdrag",
  
  // Ber√§knade v√§rden
  "entry.ROT_CALCULATED_AMOUNT": "0 kr",
  "entry.calculated_price": "DETALJERAD PRISBER√ÑKNING TEXT..."
}
```

### ‚ö†Ô∏è VIKTIGA ANTECKNINGAR F√ñR ZAPIER

1. **Checkbox-hantering:** `typ_av_fonster[]` skickas som kommaseparerad str√§ng
2. **ROT-ber√§kning:** Endast skickas om ROT-avdrag √§r aktivt
3. **Materialkostnad:** Nya ber√§kningsordningen √§r implementerad
4. **Tomma v√§rden:** F√§lt med tomma v√§rden skickas inte alls
5. **Automatisk fastighetsbeteckning:** S√§tts till "-" om tomt

---

## 6. SPECIALV√ÑRDEN OCH VALIDERING

### ‚úÖ VALIDERINGS-REGLER

1. **Obligatoriska f√§lt:**
   - company, email, phone, address, postal_code, city
   - typ_av_renovering, arbetsbeskrivning  
   - fastighet_rot_ber√§ttigad, √§r_du_ber√§ttigad_rot_avdrag

2. **Antal-validering:**
   - Minst ett antal-f√§lt > 0 kr√§vs
   - F√∂nsterpartier ska matcha totala luftare

3. **Format-validering:**
   - E-post: Standard email-format
   - Telefon: Minst 8 tecken, siffror och vissa specialtecken
   - Postnummer: Exakt 5 siffror

### üîÑ AUTOMATISKA TRANSFORMATIONER

1. **Fastighetsbeteckning:** Tom ‚Üí "-" 
2. **Checkbox arrays:** Multiv√§rden ‚Üí "V√§rde1, V√§rde2, V√§rde3"
3. **Prisformatering:** Number ‚Üí "12 345 kr"
4. **ROT-ber√§kning:** Endast n√§r till√§mpligt

### üìã ZAPIER INTEGRATIONS-CHECKLIST

F√∂r att uppdatera din Zapier automation:

- [ ] Kontrollera att alla `entry.XXXXXXX` ID:n st√§mmer
- [ ] Hantera `typ_av_fonster` som kommaseparerad str√§ng  
- [ ] Uppdatera `√§r_du_ber√§ttigad_rot_avdrag` entry ID (placeholder nu)
- [ ] L√§gg till mappning f√∂r nya insatsb√•gar-alternativ
- [ ] Kontrollera att nya ber√§kningsordningen f√∂rst√•s
- [ ] Testa med tomma/partiella formul√§r
- [ ] Verifiera ROT-avdrag ber√§kningar

---

## üöÄ F√ÑRDIG F√ñR ZAPIER!

Din anbudsapp √§r nu redo f√∂r Zapier integration med denna kompletta variabelmappning. Alla f√§lt, ber√§kningar och transformationer √§r dokumenterade f√∂r smidig automation.

**Lycka till med din Zapier-setup! üéâ**