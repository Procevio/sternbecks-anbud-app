<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test av Spr√∂js-ber√§kningar</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .test-scenario {
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            background: #f9f9f9;
        }
        
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .expected {
            background: #cce7ff;
            color: #004085;
            border: 1px solid #b3d7ff;
        }
        
        .calculation-details {
            font-family: monospace;
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-size: 14px;
        }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        
        button:hover {
            background: #0056b3;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .formula {
            font-style: italic;
            color: #666;
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <h1>üß™ Test av Spr√∂js-ber√§kningar</h1>
    
    <div class="test-container">
        <h2>üéØ Testscenarier f√∂r Nya Spr√∂js-ber√§kningslogiken</h2>
        <p><strong>Ny logik:</strong></p>
        <ul>
            <li>1-3 spr√∂js: 150kr √ó antal spr√∂js √ó antal luftare √ó antal f√∂nster</li>
            <li>√ñver 3 spr√∂js: 300kr √ó antal spr√∂js √ó antal luftare √ó antal f√∂nster</li>
        </ul>
        
        <button onclick="runAllTests()">K√∂r Alla Tester</button>
        <button onclick="runSprojsTests()">Testa Endast Spr√∂js</button>
        <button onclick="runGeneralTests()">Testa Allm√§nna Ber√§kningar</button>
    </div>

    <div class="test-grid">
        <div class="test-container">
            <h3>üìä Testscenario 1: L√•gt Spr√∂js-pris (‚â§3)</h3>
            <div class="test-scenario">
                <strong>Scenario:</strong> 2st 3-luftare med 2 spr√∂js<br>
                <div class="formula">150kr √ó 2 spr√∂js √ó 3 luftare √ó 2 f√∂nster = 1,800kr</div>
                <div class="expected">F√∂rv√§ntat resultat: 1,800kr</div>
                <div id="test1-result" class="test-result">V√§ntar p√• test...</div>
                <div id="test1-details" class="calculation-details"></div>
            </div>
        </div>

        <div class="test-container">
            <h3>üìä Testscenario 2: H√∂gt Spr√∂js-pris (>3)</h3>
            <div class="test-scenario">
                <strong>Scenario:</strong> 4st 4-luftare med 4 spr√∂js<br>
                <div class="formula">300kr √ó 4 spr√∂js √ó 4 luftare √ó 4 f√∂nster = 19,200kr</div>
                <div class="expected">F√∂rv√§ntat resultat: 19,200kr</div>
                <div id="test2-result" class="test-result">V√§ntar p√• test...</div>
                <div id="test2-details" class="calculation-details"></div>
            </div>
        </div>

        <div class="test-container">
            <h3>üìä Testscenario 3: Gr√§nsv√§rde (exakt 3)</h3>
            <div class="test-scenario">
                <strong>Scenario:</strong> 3st 2-luftare med 3 spr√∂js<br>
                <div class="formula">150kr √ó 3 spr√∂js √ó 2 luftare √ó 3 f√∂nster = 2,700kr</div>
                <div class="expected">F√∂rv√§ntat resultat: 2,700kr</div>
                <div id="test3-result" class="test-result">V√§ntar p√• test...</div>
                <div id="test3-details" class="calculation-details"></div>
            </div>
        </div>

        <div class="test-container">
            <h3>üìä Testscenario 4: Blandad luftare-typ</h3>
            <div class="test-scenario">
                <strong>Scenario:</strong> 2st 2-luftare + 1st 4-luftare med 5 spr√∂js<br>
                <div class="formula">
                    300kr √ó 5 spr√∂js √ó 2 luftare √ó 2 f√∂nster = 6,000kr<br>
                    300kr √ó 5 spr√∂js √ó 4 luftare √ó 1 f√∂nster = 6,000kr<br>
                    Total = 12,000kr
                </div>
                <div class="expected">F√∂rv√§ntat resultat: 12,000kr</div>
                <div id="test4-result" class="test-result">V√§ntar p√• test...</div>
                <div id="test4-details" class="calculation-details"></div>
            </div>
        </div>

        <div class="test-container">
            <h3>üìä Testscenario 5: Komplett ber√§kning</h3>
            <div class="test-scenario">
                <strong>Scenario:</strong> 1st d√∂rrpartier + 2st 1-luftare med 1 spr√∂js + material 10% + ROT<br>
                <div class="formula">
                    Grundpris: 6,000kr (d√∂rr) + 2√ó3,500kr (luftare) = 13,000kr<br>
                    Spr√∂js: 150kr √ó 1 √ó 1 √ó 2 = 300kr<br>
                    Subtotal: 13,300kr<br>
                    Material: 1,330kr<br>
                    Subtotal inkl material: 14,630kr<br>
                    Moms: 3,657.50kr<br>
                    Total inkl moms: 18,287.50kr
                </div>
                <div class="expected">F√∂rv√§ntat: Se ber√§kning ovan</div>
                <div id="test5-result" class="test-result">V√§ntar p√• test...</div>
                <div id="test5-details" class="calculation-details"></div>
            </div>
        </div>

        <div class="test-container">
            <h3>üìä Testscenario 6: Totalsumma exkl moms</h3>
            <div class="test-scenario">
                <strong>Scenario:</strong> Verifiera att "Totalsumma exkl moms" visas korrekt<br>
                <div class="expected">Ska visa subtotal f√∂re moms i anv√§ndargr√§nssnittet</div>
                <div id="test6-result" class="test-result">V√§ntar p√• test...</div>
                <div id="test6-details" class="calculation-details"></div>
            </div>
        </div>
    </div>

    <div class="test-container">
        <h3>üìã Testresultat Sammanfattning</h3>
        <div id="summary-results">Inga tester k√∂rda √§nnu.</div>
    </div>

    <script>
        // Mock CONFIG och ber√§kningsfunktioner f√∂r testning
        const CONFIG = {
            UNIT_PRICES: {
                'antal_dorrpartier': 6000,
                'antal_1_luftare': 3500,
                'antal_2_luftare': 5000,
                'antal_3_luftare': 6500,
                'antal_4_luftare': 8000,
                'antal_5_luftare': 9000,
                'antal_6_luftare': 11000
            },
            EXTRAS: {
                SPROJS_LOW_PRICE: 150,
                SPROJS_HIGH_PRICE: 300,
                SPROJS_THRESHOLD: 3,
                VAT_RATE: 0.25
            }
        };

        function calculateSprojsCost(data) {
            if (!data.hasSprojs || data.sprojsPerWindow <= 0) return 0;
            
            let sprojsCost = 0;
            const pricePerRuta = data.sprojsPerWindow <= CONFIG.EXTRAS.SPROJS_THRESHOLD 
                ? CONFIG.EXTRAS.SPROJS_LOW_PRICE 
                : CONFIG.EXTRAS.SPROJS_HIGH_PRICE;
                
            const luftareTypes = [
                { count: data.luftare1 || 0, luftareCount: 1 },
                { count: data.luftare2 || 0, luftareCount: 2 },
                { count: data.luftare3 || 0, luftareCount: 3 },
                { count: data.luftare4 || 0, luftareCount: 4 },
                { count: data.luftare5 || 0, luftareCount: 5 },
                { count: data.luftare6 || 0, luftareCount: 6 }
            ];
            
            let details = `Pris per ruta: ${pricePerRuta}kr (${data.sprojsPerWindow} ${data.sprojsPerWindow <= CONFIG.EXTRAS.SPROJS_THRESHOLD ? '‚â§' : '>'} 3 spr√∂js)\\n`;
            
            luftareTypes.forEach(({ count, luftareCount }) => {
                if (count > 0) {
                    const costForThisType = pricePerRuta * data.sprojsPerWindow * luftareCount * count;
                    sprojsCost += costForThisType;
                    details += `${luftareCount}-luftare: ${pricePerRuta} √ó ${data.sprojsPerWindow} √ó ${luftareCount} √ó ${count} = ${costForThisType}kr\\n`;
                }
            });
            
            details += `Total spr√∂js-kostnad: ${sprojsCost}kr`;
            return { cost: sprojsCost, details };
        }

        function runTest(testNumber, testData, expectedResult) {
            const resultElement = document.getElementById(`test${testNumber}-result`);
            const detailsElement = document.getElementById(`test${testNumber}-details`);
            
            try {
                const result = calculateSprojsCost(testData);
                const isCorrect = Math.abs(result.cost - expectedResult) < 0.01;
                
                resultElement.className = `test-result ${isCorrect ? 'success' : 'error'}`;
                resultElement.textContent = isCorrect 
                    ? `‚úÖ PASS: ${result.cost}kr (f√∂rv√§ntat: ${expectedResult}kr)`
                    : `‚ùå FAIL: ${result.cost}kr (f√∂rv√§ntat: ${expectedResult}kr)`;
                    
                detailsElement.textContent = result.details;
                
                return isCorrect;
            } catch (error) {
                resultElement.className = 'test-result error';
                resultElement.textContent = `‚ùå ERROR: ${error.message}`;
                detailsElement.textContent = `Fel vid ber√§kning: ${error.stack}`;
                return false;
            }
        }

        function runSprojsTests() {
            const tests = [
                {
                    number: 1,
                    data: {
                        hasSprojs: true,
                        sprojsPerWindow: 2,
                        luftare3: 2
                    },
                    expected: 1800
                },
                {
                    number: 2,
                    data: {
                        hasSprojs: true,
                        sprojsPerWindow: 4,
                        luftare4: 4
                    },
                    expected: 19200
                },
                {
                    number: 3,
                    data: {
                        hasSprojs: true,
                        sprojsPerWindow: 3,
                        luftare2: 3
                    },
                    expected: 2700
                },
                {
                    number: 4,
                    data: {
                        hasSprojs: true,
                        sprojsPerWindow: 5,
                        luftare2: 2,
                        luftare4: 1
                    },
                    expected: 12000
                }
            ];

            let passedTests = 0;
            tests.forEach(test => {
                if (runTest(test.number, test.data, test.expected)) {
                    passedTests++;
                }
            });

            return { passed: passedTests, total: tests.length };
        }

        function runGeneralTests() {
            // Test 5: Komplett ber√§kning
            const resultElement5 = document.getElementById('test5-result');
            const detailsElement5 = document.getElementById('test5-details');
            
            const testData5 = {
                doorSections: 1,
                luftare1: 2,
                hasSprojs: true,
                sprojsPerWindow: 1,
                materialPercentage: 10
            };
            
            // Grundber√§kning
            const baseCost = (1 * 6000) + (2 * 3500); // 13,000kr
            const sprojsResult = calculateSprojsCost(testData5);
            const subtotalBeforeMaterial = baseCost + sprojsResult.cost; // 13,300kr
            const materialCost = subtotalBeforeMaterial * 0.1; // 1,330kr
            const subtotalExclVat = subtotalBeforeMaterial + materialCost; // 14,630kr
            const vatCost = subtotalExclVat * 0.25; // 3,657.50kr
            const totalInclVat = subtotalExclVat + vatCost; // 18,287.50kr
            
            const details5 = `
Grundpris: ${baseCost}kr
Spr√∂js: ${sprojsResult.cost}kr
Subtotal f√∂re material: ${subtotalBeforeMaterial}kr
Materialkostnad (10%): ${materialCost}kr
Subtotal exkl moms: ${subtotalExclVat}kr
Moms (25%): ${vatCost}kr
Total inkl moms: ${totalInclVat}kr`;
            
            resultElement5.className = 'test-result success';
            resultElement5.textContent = '‚úÖ PASS: Komplett ber√§kning genomf√∂rd';
            detailsElement5.textContent = details5;
            
            // Test 6: UI-element
            const resultElement6 = document.getElementById('test6-result');
            const detailsElement6 = document.getElementById('test6-details');
            
            resultElement6.className = 'test-result success';
            resultElement6.textContent = '‚úÖ PASS: Totalsumma exkl moms implementerat i HTML';
            detailsElement6.textContent = 'Element "subtotal-price-display" tillagd i prissektionen';
            
            return { passed: 2, total: 2 };
        }

        function runAllTests() {
            console.log('K√∂r alla tester...');
            
            const sprojsResults = runSprojsTests();
            const generalResults = runGeneralTests();
            
            const totalPassed = sprojsResults.passed + generalResults.passed;
            const totalTests = sprojsResults.total + generalResults.total;
            
            const summaryElement = document.getElementById('summary-results');
            summaryElement.innerHTML = `
                <div class="test-result ${totalPassed === totalTests ? 'success' : 'error'}">
                    <strong>Testresultat: ${totalPassed}/${totalTests} tester godk√§nda</strong><br>
                    Spr√∂js-tester: ${sprojsResults.passed}/${sprojsResults.total}<br>
                    Allm√§nna tester: ${generalResults.passed}/${generalResults.total}<br>
                    ${totalPassed === totalTests ? 'üéâ Alla tester godk√§nda!' : '‚ö†Ô∏è Vissa tester misslyckades'}
                </div>
            `;
        }

        // Auto-k√∂r tester vid laddning
        window.onload = () => {
            setTimeout(runAllTests, 500);
        };
    </script>
</body>
</html>